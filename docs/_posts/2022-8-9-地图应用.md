# 基于百度地图的物流管理系统

### **任务目标**

- 理解地图数据收集与存储方案
- 理解Reactor线程模型
- 掌握通过Netty编写服务端应用
- 掌握Kafka集群的部署
- 掌握地图数据的收集方案的实现
- 理解MongoDB分片式集群
- 掌握接收消息存储到MongoDB
- 掌握压力测试的方法



## 为什么使用MongoDB

* 因为涉及到海量数据存储的问题，MongoDB集群分布更合适
* 与关系数据库相比，性能调整轻而易举。
* 非常容易扩展。
* 因为它是一个 NOSQL 数据库，它本质上是安全的，因为它不能执行 SQL 注入。
* MongoDB 支持的文档查询语言在支持动态查询方面起着至关重要的作用。
* MongoDB 不需要使用虚拟机。
* 由于它将数据存储在内部存储器中，因此可以更快地访问数据。
* 不需要将应用程序对象与数据对象相关联。
* MongoDB 也可以用作文件系统，这使得负载平衡更加容易。
* 有大量可访问的文档。



## 3、为什么选择MongoDB？

> **参考回答：**

之所以选择MongoDB是因为它天生就支持海量数据的存储，可以很好的水平扩容，虽然它不能像传统的关系型数据库那样进行多表联合查询，但对我们的业务而言单表操作足够了。

在MongoDB中，我们会存储好友关系、用户发表的动态、推荐的结果等数据。

对于MongoDB的集群而且，我们采用了它的分片式集群，这种集群方式有很好的扩展性，使用层面是直接连接到mongos服务即可完成集群的操作，非常的方便。

> 说明：如果要继续答分片式集群的话请参考课件中的知识模块。

作者：海拥
链接：https://juejin.cn/post/6994337229292175374
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

## 5、项目中短信是怎么发送的？如果发送失败怎么处理？

> **参考回答：**

项目中的短信是通过阿里云的短信服务发送的，之所以选择阿里云是由于它相对比较稳定，由于我们发送量并不是很大，所以我们只接入了这一个通道，如果后期量大的了话会考虑接入多个通道来确保短信服务的稳定性。

如果短信发送失败的话，我们会这样处理：

- 首先，我们的发送短信的代码是做了重试功能的，这样基本可以确保网络故障的场景下能恢复发送
- 如果重试3次后依然出错的话，应该是通道或账号出现了问题，我们会将错误记录到日志中，会有后续的日志监控进行监控，及时的发现问题并解决问题。

高并发接受用户数据 Netty Kafka 
应用背景解决车辆线路相关的问题

* 车辆线路规划
* 车辆运行时的电子围栏（线性电子围栏） 车辆进入/出离区域会发出报警信息 车辆驶出规定路线给出报警（线性围

栏）

* 车辆运行轨迹的纠偏
* 车辆运行记录的线路补偿 车辆运行中有路线缺失，给出补偿

## 功能介绍

### 订单管理（面向后台管理）

* 订单是用户在物流系统中下的订单，比如：寄一件衣服从上海到北京
  订单管理列表  建立订单表
  序号 订单编号 运单编号 下单时间 订单状态 发件人姓名 发件人电话 操作
* 根据订单规划路径
  在订单详情中，通过百度地图显示出订单的路径规划

### 运单管理（面向用户）

* 运单是物流系统为每个订单生成的运单号，一般是告知用户的，用户根据订单号查询物流状态信息
* 运单管理表
  序号 运单编号 运单状态 调度状态 订单编号 下单时间 发件人姓名 发件人手机 操作（查看详情）

#### 电子围栏

通过设置多边形的电子围栏对车辆进行监控，如果超出范围就会告警

#### 车辆管理

在车辆管理的界面中，如果有车辆超出了电子围栏就会有红色告警信息显示
序号 车辆编号 车辆类型 车辆号码 电子围栏警告 车辆当前位置 操作（查看详情 删除 ） 新增车辆
超出范围给司机打电话  发消息等



## 实现

前端使用VUE

### 电子围栏

点击新增，调用百度地图API，以鼠标点击拖动的形式绘制各种形式的围栏，围栏创建后有围栏名称，这样新增车辆后可以进行关联

```
db.createUser({
	user:"jinyun",pwd:'ddd',roles| {role:"readWrite",db:"jinyun"}|}
});
```



### 后端
MongoDB+百度地图



## 轨迹坐标数据收集与存储

困难

1. 高并发上报地理位置的请求如何解决
2. 海量坐标数据如何存储

![image-20220810190403330](E:\gitfile\modiman.github.io\docs\_posts\imgs\image-20220810190403330.png)

​	l关于上图的说明如下：

l客户端可能会有多种，可以是移动端APP、微信小程序、浏览器等。

l客户端一般会发送http请求，为了高效的处理用户请求，我们采用Netty来处理用户的请求。

* lNetty是一个高性能的、异步的、基于事件驱动的网络应用框架。
* lNetty服务在接收到请求后，自己并不完成数据存储的工作，而是将数据发送给Kafka消息服务器。
* l这样做的好处，Netty服务可以更快速给用户响应，自己的变得更加轻量化。
* lKafka 是一个开源消息系统，是Apache 软件基金会开发的一个开源消息系统项目。
* l该项目的目标是为处理实时数据提供一个统一、高通量、低延迟的平台。

![image-20220810190557727](E:\gitfile\modiman.github.io\docs\_posts\imgs\image-20220810190557727.png)





 ## 分表

* [掘金](https://juejin.cn/post/6995504951480811550)

业务背景：随着时间的推移数据量疯狂增长

策略：按月分表

- **协议服务** 接收设备上传数据，解码，封装，发生带数据处理服务
- **数据处理** 对数据进行业务处理，添加时间字段（如分钟数据填加hour、day...）
- **存储服务** 按照数据类型对数据进行存储前业务处理，数据目标表，分表实现