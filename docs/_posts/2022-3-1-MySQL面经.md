# 索引



### 1.MySQL索引，问了20分钟

* [我以为我对Mysql*索引*很了解，直到我遇到了阿里的面试官](https://zhuanlan.zhihu.com/p/73204847)





​       一张表可以建立**任意多个索引，**每个索引可以是**任意多个字段**的组合。索引**可能会提高查询速度**（如果查询时使用了索引），但**一定会减慢写入速度**，因为每次写入时都需要更新索引，所以索引只应该加在经常需要搜索的列上，不要加在写多读少的列上。

#### 单列索引与复合索引

只包含一个字段的索引叫做**单列索引**，包含两个或以上字段的索引叫做**复合索引**（或组合索引）。

建立复合索引时，字段的顺序极其重要。

下面这个SQL语句在 列X，列Y，列Z 上建立了一个复合索引。

```mysql
CREATE INDEX 索引名 ON 表名(列名X, 列名Y, 列名Z);
```

### 索引建立的动机

* 数据库系统基础教程 p223

当关系变得很大时，通过扫描所有元组找到匹配给定查询条件的元组的代价太高

### 索引的声明

```mysql
create index yearindex on Movie(year)
```

这样SQL查询处理器在处理制定年份的查询时，仅仅对年份为指定值的Movies的元组进行测试，从而使获得查询结果的时间大大缩短





## B+树

* 作者：孤独烟
* 链接：https://zhuanlan.zhihu.com/p/107228878
* 来源：知乎
* 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

#### B+树的两个明显特点

1. 数据只出现在叶子节点
2. 所有叶子节点增加了一个链指针

#### 针对上面的B+树和B树的特点，我们做一个总结

**(1)**B树的树内存储数据，因此查询单条数据的时候，B树的查询效率不固定，最好的情况是O(1)。我们可以认为在做单一数据查询的时候，使用B树平均性能更好。但是，由于B树中各节点之间没有指针相邻，因此B树不适合做一些数据遍历操作。

**(2)**B+树的数据只出现在叶子节点上，因此在查询单条数据的时候，查询速度非常稳定。因此，在做单一数据的查询上，其平均性能并不如B树。但是，B+树的叶子节点上有指针进行相连，因此在做数据遍历的时候，只需要对叶子节点进行遍历即可，这个特性使得B+树非常适合做[范围查询](https://www.zhihu.com/search?q=范围查询&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"article"%2C"sourceId"%3A"107228878"})。

​         因此，我们可以做一个推论:没准是Mysql中数据遍历操作比较多，所以用B+树作为索引结构。而Mongodb是做单一查询比较多，数据遍历操作比较少，所以用B树作为索引结构。

***那么为什么Mysql做数据遍历操作多？而Mongodb做数据遍历操作少呢？***

 因为Mysql是关系型数据库，而Mongodb是非关系型数据。









#### B+ Tree索引和Hash索引区别

* [哈希索引](https://www.zhihu.com/search?q=哈希索引&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"article"%2C"sourceId"%3A"73204847"})适合等值查询，但是无法进行范围查询 
* 哈希索引没办法利用索引完成排序

* 哈希索引不支持多列联合索引的最左匹配规则
* 如果有大量重复键值得情况下，哈希索引的效率会很低，因为存在哈希碰撞问题

#### 最左前缀匹配

面试官：那你知道最左前缀匹配吗？

我：（我突然想起来原来面试官是想问这个，怪自己刚刚为什么就没想到这个呢。）哦哦哦。您刚刚问的是这个意思啊，在创建多列索引时，我们根据业务需求，where子句中使用最频繁的一列放在最左边，因为MySQL索引查询会遵循最左前缀匹配的原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。所以当我们创建一个联合索引的时候，如(key1,key2,key3)，相当于创建了（key1）、(key1,key2)和(key1,key2,key3)三个索引，这就是最左匹配原则。





我们平时建表的时候都会为表加上主键， 在某些关系数据库中， 如果建表时不指定主键，数据库会拒绝建表的语句执行。 事实上， 一个加了主键的表，并不能被称之为「表」。一个没加主键的表，它的数据无序的放置在磁盘存储器上，一行一行的排列的很整齐， 跟我认知中的「表」很接近。如果给表上了主键，那么表在磁盘上的存储结构就由整齐排列的结构转变成了树状结构，也就是上面说的「平衡树」结构，换句话说，就是整个表就变成了一个索引。没错， 再说一遍， 整个表变成了一个索引，也就是所谓的「聚集索引」。 这就是为什么一个表只能有一个主键， 一个表只能有一个「聚集索引」，因为主键的作用就是把「表」的数据格式转换成「索引（平衡树）」的格式放置。



作者：陈大侠
链接：https://zhuanlan.zhihu.com/p/23624390
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



#### 数据库系统基础教程

* 关系中属性A上的索引是一种数据结构，他能提高在属性A上查找具有某个特定值的元祖的效率
* 

## 索引的选择

* 索引的选择需要做一个开销上的分析
* 索引的选择是数据库设计成败的一个重要因素

### 简单代价模型

​       为了检查元组，需要将包含它的整个磁盘页调入主存，检查一个磁盘页上的所有元组所花费的时间通常和检查一个元组所花费的时间几乎没什么差别。

### 一些有用的索引

通常关系上最有用的索引是其键上的索引，原因有两个”：

1. 在查询中为主键指定值是比较普遍的，因此，键上的索引通常会被频繁的使用
2. 因为键值是唯一的，故与给定键值匹配的元组最多只有一个，因此索引返回的要么是这个元组的位置，要么什么也不返回。也就是说，为了取得这个元组，最多只有一个磁盘页需要被读入到磁盘页



### 计算最佳索引



### 2.主键的优点与缺点

1.自增主键，在mysql中应用最广泛。

**优点：**
    1>需要很小的数据存储空间，仅仅需要4 byte。（bigint类型，是8 byte）

　　　2>insert和update操作时使用INT的性能比UUID好，所以使用int将会提高应用程序的性能。

​    3>index和Join操作，int的性能最好。

​    4>容易记忆。

**缺点：**
    1>如果经常有合并表的操作，就可能会出现主键重复的情况。

​    2>使用int数据范围有限制。如果存在大量的数据，可能会超出int的取值范围。

​    3>很难处理分布式存储的数据表。

2。UUID

**优点：**
    1>能够保证独立性，程序可以在不同的数据库间迁移，效果不受影响。
    2>保证生成的ID不仅是表独立的，而且是库独立的，这点在你想切分数据库的时候尤为重要。
**缺点：**
    1>比较占地方，和INT类型相比，存储一个UUID要花费更多的空间。
    2>使用UUID后，URL显得冗长，不够友好。

​    3>没有内置的函数获取最新产生的UUID主键。

​    4>很难记忆。Join操作性能比int要低。

​    5>UUID做主键将会添加到表上的其他索引中，因此会降低性能。

