

### cmd进入mysql

1. 将mysql.exe路径加入到环境变量

2. ```bash
   mysql -hlocalhost -uroot -p
   ```

3. 更改用户密码

   ```mysql
   ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';
   ```

# SQL 分类

**SQL 语句主要可以划分为以下 3 个类别。**

**DDL（Data Definition Languages）语句：**数据定义语言，这些语句定义了不同的数据段、数据库、表、列、索引等数据库对象的定义。常用的语句关键字主要包括 create、drop、alter等。

**DML（Data Manipulation Language）语句：**数据操纵语句，用于添加、删除、更新和查询数据库记录，并检查数据完整性，常用的语句关键字主要包括 insert、delete、udpate 和select 等。(增添改查）

**DCL（Data Control Language）语句：**数据控制语句，用于控制不同数据段直接的许可和访问级别的语句。这些语句定义了数据库、表、字段、用户的访问权限和安全级别。主要的语句关键字包括 grant、revoke 等。

## DDL

### cteate

```sql
create datebase test;
create table emp(
	ename varchar(10),
	hiredate date,
	sal decimal(10,2),deptno int(2)
);
```

### drop

```sql
drop database dbname;
drop table emp;
```

### alter

```sql
# 修改表名
alter table emp rename emp1;
# 修改字段类型
alter table emp modify ename varchar(20);
# 添加字段
alter table emp add column age int(3);
# 删除字段
alter table emp drop column age;
# 修改字段名
alter table emp change age age1 int(4) ;
```

## DML

DML 操作是指对数据库中表记录的操作，主要包括表记录的插入（insert）、更新（update）、删除（delete）和查询（select）

### select 笛卡尔积

#### 连接操作

```mysql
select * from stu,gpa
# 或
# select * from stu   cross join gpa
```

#### 连接结果

#### 图解

![image-20220228190709300](https://github.com/modiman/modiman.github.io/blob/gh-pages/docs/_posts/imgs/笛卡尔积.png?raw=true)



### select 自然连接

**此操作仅仅把在A和B中有共同属性，且此共同属性有相同的值的元组配对**

#### 连接操作

在使用查询语句时不需要where子句

```mysql
SELECT * FROM stu NATURAL JOIN gpa
# 等同于
# SELECT * FROM stu NATURAL JOIN gpa
# WHERE stu.sno = gpa.sno
```

### select 内连接

**（等值连接）**

“inner join 内连接”的处理方式：虽然重复，但两份都保留。如R和S进行内连接，R和S都存在属性B，进行内连接后结果包含属性                              A  ,      R.B,       S.B,     C ,

* 如果没有条件限制，会返回所有结果，等同于笛卡尔积
* 如果有条件限制，只保留满足条件的元组，但会保留重复属性
* 查询子句使用关键字on



```mysql
SELECT * FROM stu INNER JOIN gpa
on stu.sno = gpa.sno
```

| sno  | sname | sno  | gpa  |
| ---- | ----- | ---- | ---- |
| 1    | tom   | 1    | 122  |
| 2    | jack  | 2    | 98   |
| 3    | jerry | 3    | 150  |

### select 外连接

**分左外连接（left join）和右外连接（right join）**

#### 图解

![image-20220228190709300](https://github.com/modiman/modiman.github.io/blob/gh-pages/docs/_posts/imgs/外连接.png?raw=true)]

![](.\imgs\外连接.png)

### select函数

#### length

查询文本列中每一行的长度

```mysql
SELECT LENGTH(item_content)  FROM intro
```

 返回一列，分别代表每一行文本的长度

#### sum

查询所有行文本字数总和

```sql
# 把刚才查到的结果作为一个新的表i，结果列重命名为len,利用sum函数求长度列的总和
SELECT SUM(i.len) FROM 
(
(SELECT LENGTH(item_content) AS len 
 FROM intro) AS i
)
```

#### max

题目：运营想要知道复旦大学学生gpa最高值是多少，请你取出相应数据

```sql
# 方法1
# select max(gpa) as gpa
# from user_profile
# where university='复旦大学';
 
# 方法2
select gpa
from user_profile
where university='复旦大学'
order by gpa desc limit 1
```

#### avg

```sql
select
  count(gender) as male_num,
  round(avg(gpa), 1) as avg_gpa
from user_profile where gender="male";
```

#### case

题目：现在运营想要将用户划分为25岁以下和25岁及以上两个年龄段，分别查看这两个年龄段用户数量

**本题注意：age为null 也记为 25岁以下**

```mysql
SELECT CASE WHEN age < 25 OR age IS NULL THEN '25岁以下'
            WHEN age >= 25 THEN '25岁及以上'
            END age_cut,COUNT(*)number
FROM user_profile
GROUP BY age_cut
```



题目：现在运营想要将用户划分为**20岁以下，20-24岁，25岁及以上**三个年龄段，分别查看不同年龄段用户的明细情况，请取出相应数据。（注：若**年龄为空**请返回**其他**。）

```mysql
SELECT device_id,gender,CASE WHEN age <20 THEN '20岁以下'
	    WHEN age<=24 AND age >=20 THEN '20-24岁'
	    
	    WHEN age IS NULL THEN '其他'
            WHEN age >= 25 THEN '25岁及以上'
            END AS age_cut
FROM user_profile
```

题目：现在运营想要计算出**2021年8月每天用户练习题目的数量**，请取出相应数据。

```mysql
select
    day(date) as day,
    count(question_id) as question_cnt
from question_practice_detail
where month(date)=8 and year(date)=2021
group by date

/*
SELECT 
RIGHT(`date`,2) AS DAY,COUNT(*)  
FROM question_practice_detail
WHERE `date` LIKE '2021-08%'
GROUP BY DATE
*/
```

题目：现在运营举办了一场比赛，收到了一些参赛申请，表数据记录形式如下所示，现在运营想要统计每个性别的用户分别有多少参赛者，请取出相应结果

```mysql
SELECT  CASE 
WHEN `profile` LIKE  '%female' THEN 'female'
ELSE 'male'
END AS gender,COUNT(*)
FROM user_submit
GROUP BY gender 


/*
SELECT IF(profile LIKE '%female','female','male') gender,COUNT(*) number
FROM user_submit
GROUP BY gender;
*/
```

题目：现在运营举办了一场比赛，收到了一些参赛申请，表数据记录形式如下所示，现在运营想要统计每个年龄的用户分别有多少参赛者，请取出相应结果

```mysql
SELECT CASE 
WHEN PROFILE  LIKE '%female' THEN SUBSTRING(PROFILE,-9,2)
ELSE SUBSTRING(PROFILE,-7,2)
END AS age ,COUNT(*)
FROM user_submit
GROUP BY age
```

题目：现在运营想要找到每个学校gpa最低的同学来做调研，请你取出每个学校的最低gpa。

```mysql
select device_id,university,gpa from 
(
select university,min(gpa)  as gpa
from user_profile
GROUP BY university
)a  natural  JOIN user_profile 
order by university


/*
select device_id,university,gpa
from user_profile
where (university,gpa) in (select university,min(gpa) from user_profile group by university)
order by university
*/




```

### 关键字

#### 过滤空值

```mysql
select   device_id,gender,age,university
from user_profile
WHERE  age is not null
# where age >0 or age <=0
# where age !='';
```

#### in

```mysql
select device_id,gender,age,university,gpa from user_profile
where university in('北京大学','复旦大学','山东大学');
# WHERE  university = "北京大学" or university = "复旦大学" or university = "山东大学" 
```

#### like

```mysql
select   device_id,age,university
from user_profile 
where university like "%北京%"
```

```sql
SELECT  t1.trace_id ,
		t1. tag_id,
		t1.tag_name,
		t1.area_id ,
		area.name
FROM  (SELECT 
		trace.trace_id ,
		tag.id AS tag_id,
		tag.name AS tag_name,
		trace.area_id 
		FROM trace LEFT JOIN tag  ON trace.tag_id = tag.id) AS t1
LEFT JOIN `area` 
ON t1.area_id = area.id


SELECT
            trace.trace_id,
            tag.id AS tag_id,
            tag.name,
            area.name,
            trace.area_begin_time,
            trace.area_leave_time
FROM
trace ,tag, `area`
WHERE trace.tag_id = tag.id AND trace.area_id = area.id
    
    
SELECT t1.tname,t1.mres,t2.tname,t1.time FROM 
(SELECT m.mid,t.tname,m.mres,m.matime AS TIME FROM m LEFT JOIN t ON t.tid = m.hid) 
AS t1 
LEFT JOIN 
(SELECT m.mid,t.tname,m.mres,m.matime AS TIME FROM m LEFT JOIN t ON t.tid = m.gid) 
AS t2 
ON t1.mid = t2.mid WHERE t1.time BETWEEN '2006-06-01' AND '2006-07-01';
```



### 分组计算 group by



题目：现在运营想要对每个学校不同性别的用户活跃情况和发帖数量进行分析，请分别计算出每个学校每种性别的用户数、30天内平均活跃天数和平均发帖数量。

```mysql
SELECT gender,university,COUNT(device_id),ROUND(AVG(active_days_within_30),1),ROUND(AVG(question_cnt),1) FROM user_profile GROUP BY university,gender
```

题目：现在运营想查看每个学校用户的平均发贴和回帖情况，寻找低活跃度学校进行重点运营，请取出平均发贴数低于5的学校或平均回帖数小于20的学校。

````mysql
SELECT university,ROUND(AVG(question_cnt),4) ,ROUND(AVG(answer_cnt),4) 
FROM user_profile GROUP BY university
HAVING ROUND(AVG(answer_cnt),4)<20 OR ROUND(AVG(question_cnt),4)  <5
````



运营想要了解每个学校答过题的用户平均答题数量情况，请你取出数据。

```mysql
# count(*)表示学校出现次数
# sum(c) 表示该学校总答题数量

SELECT university,SUM(c)/COUNT(*) FROM

# 先查出答题学生的学校及答题数量作为t备用
(SELECT university,COUNT(university) AS c
FROM  question_practice_detail  NATURAL  JOIN user_profile
GROUP BY university,device_id )t

GROUP BY t.university
ORDER BY university
```

题目：运营想要计算一些**参加了答题**的不同学校、不同难度的用户平均答题量，请你写SQL取出相应数据

题目涉及三张表

user_profile

| id   | device_id | gender | age  | university | gpa  |
| ---- | --------- | ------ | ---- | ---------- | ---- |

question_practice_detail

| id   | device_id | question_id | result |
| ---- | --------- | ----------- | ------ |

question_detail

| id   | question_id | difficult_level |
| ---- | ----------- | --------------- |

1. 将question_practice_detail与question_detail自然连接，为question_practice_detail表加入**难度**属性，新生成的表命名为d

```mysql
SELECT  * FROM question_practice_detail NATURAL JOIN 
(SELECT question_id ,difficult_level FROM question_detail)d
```

2. 将 user_profile与d自然连接得到l，表l属性包括device_id,university,difficult_level

```mysql
SELECT * FROM 
	      (SELECT device_id,university FROM user_profile) 
	      u
	NATURAL JOIN 
		(  SELECT  device_id,question_id ,difficult_level 
		   FROM 
		      question_practice_detail 
		   NATURAL JOIN  
			 (SELECT question_id ,difficult_level FROM question_detail)
		       d
		)
	      a
```

3. 求出各个大学难度的答题数量，存放在表f中，f的属性包括university , difficult_level,c（答题数量）

```mysql
SELECT university , difficult_level,COUNT(*) AS c FROM 
(
	SELECT * FROM 
	      (SELECT device_id,university FROM user_profile) 
	      u
	NATURAL JOIN 
		(  SELECT  device_id,question_id ,difficult_level 
		   FROM 
		      question_practice_detail 
		   NATURAL JOIN  
			 (SELECT question_id ,difficult_level FROM question_detail)
		       d
		)
	      a
	      )l
GROUP BY  university  , difficult_level,device_id
```

4. 对各大学各难度答题数量求和，除以人数得到平均值

```mysql
SELECT university,difficult_level,SUM(c)/COUNT(*) FROM 
(
SELECT university , difficult_level,COUNT(*) AS c FROM 
(
	SELECT * FROM 
	      (SELECT device_id,university FROM user_profile) 
	      u
	NATURAL JOIN 
		(  SELECT  device_id,question_id ,difficult_level 
		   FROM 
		      question_practice_detail 
		   NATURAL JOIN  
			 (SELECT question_id ,difficult_level FROM question_detail)
		       d
		)
	      a
	      )l
GROUP BY  university  , difficult_level,device_id
)f
GROUP BY  university, difficult_level
```

### 组合查询

题目：现在运营想要分别查看学校为山东大学或者性别为男性的用户的device_id、gender、age和gpa数据，请取出相应结果，**结果不去重。**

```mysql
select 
    device_id, gender, age, gpa
from user_profile
where university='山东大学'

union all

select 
    device_id, gender, age, gpa
from user_profile
where gender='male'
```



### update

批量修改id

```mysql
UPDATE intro SET item_id=item_id-5819
UPDATE  ships SET  ship_troop='未知' WHERE ship_troop = '' OR 	 ship_troop = '舰队'
```

字符串拼接

```mysql
UPDATE  ships SET  ship_name=CONCAT(ship_model ,ship_num) WHERE ship_name = '' 
```

### insert

```sql
 insert into emp (ename,hiredate,sal,deptno) values('zzx1','2000-01-01','2000',1);
 insert into emp values('lisa','2003-02-01','3000',2);
```



## 索引

explain

## 函数

### 

