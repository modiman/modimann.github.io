## 整合Redis

报错DefaultSerializer requires a Serializable payload but received an object of type [model.Admin]

 要缓存的 Java 对象必须实现 Serializable 接口，因为 Spring 会将对象先[序列化](https://so.csdn.net/so/search?q=序列化&spm=1001.2101.3001.7020)再存入 Redis

### 解决方法:

 将缓存实体类继承 Serializable

```java
public class Admin implements Serializable
```

## Redis启动

```
redis-server.exe redis.windows.conf
```

## Redis设置密码

```
# 查看密码
config get requirepass
# 设置密码
config set requirepass 123456
```

## Redis配置

```yaml
spring:
  redis:
    #超时时间
    timeout: 10000ms
    #服务器地址
    host: localhost
    #服务器端口
    port: 6379
    #数据库
    database: 0
    #密码
    password: 123456
    lettuce:
      pool:
        #最大连接数，默认8
        max-active: 1024
        #最大连接阻塞等待时间，默认-1
        max-wait: 10000ms
        #最大空闲连接
        max-idle: 200
        #最小空闲连接
        min-idle: 5
```

## SpringBoot+Redis存放session

添加三条依赖后重启项目，此时登录即可自动将cookie保存到redis

```xml
    <!-- spring data redis 依赖 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>
        <!-- commons-pool2 对象池依赖 -->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-pool2</artifactId>
        </dependency>
        <!-- spring-session 依赖 -->
        <dependency>
            <groupId>org.springframework.session</groupId>
            <artifactId>spring-session-data-redis</artifactId>
        </dependency>
```



**但这种方式向Redis中存放的是二进制形式的Cookie信息，可读性较差，一般自己写Redis配置类，手动定义session的序列化**

![image-20220708214634996](E:\gitfile\modiman.github.io\docs\_posts\image-20220708214634996.png)

Redis配置类RedisConfig.java

```java
package com.springboot.demo.config;

/**
 * @author: modige
 * @date: 2022/7/8 21:38
 * @description:
 */
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.StringRedisSerializer;

@Configuration
public class RedisConfig {
    @Bean
    public RedisTemplate<String,Object> redisTemplate(RedisConnectionFactory
                                                              connectionFactory){
        RedisTemplate<String,Object> redisTemplate = new RedisTemplate<>();
        //key序列器
        redisTemplate.setKeySerializer(new StringRedisSerializer());
        //value序列器
        redisTemplate.setValueSerializer(new
                GenericJackson2JsonRedisSerializer());
        //Hash类型 key序列器
        redisTemplate.setHashKeySerializer(new StringRedisSerializer());
        //Hash类型 value序列器
        redisTemplate.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());
        redisTemplate.setConnectionFactory(connectionFactory);
        return redisTemplate;
    }
}

```

