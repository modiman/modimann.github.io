```yaml

layout: post
title: "牛蛙"
date: 2021-11-13 17:04:55 -0000
categories: 日记 随笔
```

# Hadoop

## 使用docker模拟服务器集群

## 新建一个linux镜像

```shell
docker pull centos:8
```

## 使用docker images查看本地镜像

```shell
docker images
```

## 新建一个容器

```shell
docker run -d centos:8 /usr/sbin/init
```

## 查看运行中的容器

```shell
docker ps
```

## 使用新创建的容器输出hello world

```shell
docker exec dsafjasfsafa echo "hello world"
```

## 配置java和SSh环境

## 新建容器

```sh
docker run -d --name=java_ssh_proto --privileged centos:8 /usr/sbin/init
```

## 进入容器

```shell
docker exec -it java_ssh_proto bash
```

## 配置镜像

```shell
sed -e 's|^mirrorlist=|#mirrorlist=|g' \
         -e 's|^#baseurl=http://mirror.centos.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/centos|g' \
         -i.bak \
         /etc/yum.repos.d/CentOS-Linux-AppStream.repo \
         /etc/yum.repos.d/CentOS-Linux-BaseOS.repo \
         /etc/yum.repos.d/CentOS-Linux-Extras.repo \
         /etc/yum.repos.d/CentOS-Linux-PowerTools.repo \
         /etc/yum.repos.d/CentOS-Linux-Plus.repo
yum makecache
```

## 安装 OpenJDK 8 和 SSH 服务：

```bash
yum install -y java-1.8.0-openjdk-devel openssh-clients openssh-server
```

## 启用SSH

```bash
systemctl enable sshd && systemctl start sshd
```

## 保存为一个名为 java_ssh 的镜像

```bash
docker stop java_ssh_proto
docker commit java_ssh_proto java_ssh
```

## Hadoop 安装

### 下载 Hadoop

Hadoop 官网地址：http://hadoop.apache.org/

Hadoop 发行版本下载：https://hadoop.apache.org/releases.html

在目前的测试中，3.1.x 与 3.2.x 版本的兼容性较佳，本教程使用 3.1.4 版本作为案例。

Hadoop 3.1.4 镜像地址，下载好 tar.gz 压缩包文件备用。

### 创建 Hadoop 单机容器

现在以之前保存的 java_ssh 镜像创建容器 hadoop_single：

```bash
docker run -d --name=hadoop_single --privileged java_ssh /usr/sbin/init
```

将下载好的 hadoop 压缩包拷贝到容器中的 /root 目录下：

```bash
docker cp <你存放hadoop压缩包的路径> hadoop_single:/root/
```

进入容器：

```
docker exec -it hadoop_single bash
```

进入 /root 目录：

```
cd /root

```

这里应该存放着刚刚拷贝过来的 hadoop-x.x.x.tar.gz 文件，现在解压它：

```
tar -zxf hadoop-3.1.4.tar.gz
```

解压后将得到一个文件夹 hadoop-3.1.4，现在把它拷贝到一个常用的地方：

```
mv hadoop-3.1.4 /usr/local/hadoop
```

然后配置环境变量：

```
echo "export HADOOP_HOME=/usr/local/hadoop" >> /etc/bashrc
echo "export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin" >> /etc/bashrc 
```

然后退出 docker 容器并重新进入。

这时，echo $HADOOP_HOME 的结果应该是 /usr/local/hadoop

```
echo "export JAVA_HOME=/usr" >> $HADOOP_HOME/etc/hadoop/hadoop-env.sh
echo "export HADOOP_HOME=/usr/local/hadoop" >> $HADOOP_HOME/etc/hadoop/hadoop-env.sh
```

这两步配置了 hadoop 内置的环境变量，然后执行以下命令判断是否成功：

```
hadoop version
```

## 如果有java错误，找到java安装包位置，添加java环境变量，过程如hadoop
